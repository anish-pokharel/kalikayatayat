<div class="user-setup-container">
  <!-- Page Header -->
  <div class="page-header">
    <h1>User Setup Management</h1>
    <button class="btn-primary" (click)="openAddModal()">
      <span class="icon">‚ûï</span> Add New User
    </button>
  </div>

  <!-- Filters -->
  <div class="filters-section">
    <div class="search-box">
      <span class="search-icon">üîç</span>
      <input 
        type="text" 
        placeholder="Search users..." 
        [(ngModel)]="searchTerm"
        (input)="onSearch()"
      >
    </div>
    
    <div class="filter-group">
      <select [(ngModel)]="selectedRole" (change)="onFilterChange()">
        <option value="all">All Roles</option>
        <option *ngFor="let role of roles" [value]="role">{{ role | titlecase }}</option>
      </select>

      <select [(ngModel)]="selectedStatus" (change)="onFilterChange()">
        <option value="all">All Status</option>
        <option value="active">Active</option>
        <option value="inactive">Inactive</option>
        <option value="suspended">Suspended</option>
      </select>
    </div>
  </div>

  <!-- Users Table -->
  <div class="table-container">
    <table class="users-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Username</th>
          <th>Full Name</th>
          <th>Email</th>
          <th>Role</th>
          <th>Department</th>
          <th>Phone</th>
          <th>Status</th>
          <th>Last Login</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of filteredUsers">
          <td>#{{ user.id }}</td>
          <td class="username">
            <strong>{{ user.username }}</strong>
          </td>
          <td>{{ user.fullName }}</td>
          <td>{{ user.email }}</td>
          <td>
            <span class="role-badge" [ngClass]="getRoleClass(user.role)">
              {{ user.role | titlecase }}
            </span>
          </td>
          <td>{{ user.department }}</td>
          <td>{{ user.phone }}</td>
          <td>
            <span class="status-badge" [ngClass]="getStatusClass(user.status)">
              {{ user.status | titlecase }}
            </span>
          </td>
          <td>{{ user.lastLogin }}</td>
          <td class="actions">
            <button class="btn-icon" (click)="openViewModal(user)" title="View Details">
              üëÅÔ∏è
            </button>
            <button class="btn-icon" (click)="openEditModal(user)" title="Edit">
              ‚úèÔ∏è
            </button>
            <button class="btn-icon" (click)="openPermissionsModal(user)" title="Permissions">
              üîë
            </button>
            <button class="btn-icon" (click)="toggleStatus(user)" [title]="user.status === 'active' ? 'Deactivate' : 'Activate'">
              {{ user.status === 'active' ? 'üî¥' : 'üü¢' }}
            </button>
            <button class="btn-icon" (click)="openDeleteModal(user)" title="Delete">
              üóëÔ∏è
            </button>
          </td>
        </tr>
        <tr *ngIf="filteredUsers.length === 0">
          <td colspan="10" class="no-data">No users found</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Add User Modal -->
  <div class="modal" *ngIf="showAddModal">
    <div class="modal-content modal-lg">
      <div class="modal-header">
        <h2>Add New User</h2>
        <button class="close-btn" (click)="closeAddModal()">√ó</button>
      </div>
      
      <div class="modal-body">
        <form>
          <div class="form-row">
            <div class="form-group">
              <label>Username *</label>
              <input type="text" [(ngModel)]="newUser.username" name="username" required>
            </div>
            <div class="form-group">
              <label>Email *</label>
              <input type="email" [(ngModel)]="newUser.email" name="email" required>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Full Name *</label>
              <input type="text" [(ngModel)]="newUser.fullName" name="fullName" required>
            </div>
            <div class="form-group">
              <label>Phone *</label>
              <input type="text" [(ngModel)]="newUser.phone" name="phone" required>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Role</label>
              <select [(ngModel)]="newUser.role" name="role">
                <option *ngFor="let role of roles" [value]="role">{{ role | titlecase }}</option>
              </select>
            </div>
            <div class="form-group">
              <label>Department</label>
              <select [(ngModel)]="newUser.department" name="department">
                <option *ngFor="let dept of departments" [value]="dept">{{ dept }}</option>
              </select>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Status</label>
              <select [(ngModel)]="newUser.status" name="status">
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
                <option value="suspended">Suspended</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label>Default Permissions</label>
            <div class="permissions-grid">
              <div class="permission-item" *ngFor="let perm of availablePermissions">
                <label>
                  <input 
                    type="checkbox" 
                    [checked]="newUser.permissions.includes(perm)"
                    (change)="togglePermission(perm)"
                  >
                  {{ getPermissionLabel(perm) }}
                </label>
              </div>
            </div>
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button class="btn-secondary" (click)="closeAddModal()">Cancel</button>
        <button class="btn-primary" (click)="saveUser()">Create User</button>
      </div>
    </div>
  </div>

  <!-- View User Modal -->
  <div class="modal" *ngIf="showViewModal && selectedUser">
    <div class="modal-content">
      <div class="modal-header">
        <h2>User Details</h2>
        <button class="close-btn" (click)="closeViewModal()">√ó</button>
      </div>
      
      <div class="modal-body">
        <div class="details-grid">
          <div class="detail-item">
            <label>User ID</label>
            <p>#{{ selectedUser.id }}</p>
          </div>
          <div class="detail-item">
            <label>Username</label>
            <p>{{ selectedUser.username }}</p>
          </div>
          <div class="detail-item">
            <label>Full Name</label>
            <p>{{ selectedUser.fullName }}</p>
          </div>
          <div class="detail-item">
            <label>Email</label>
            <p>{{ selectedUser.email }}</p>
          </div>
          <div class="detail-item">
            <label>Role</label>
            <p>
              <span class="role-badge" [ngClass]="getRoleClass(selectedUser.role)">
                {{ selectedUser.role | titlecase }}
              </span>
            </p>
          </div>
          <div class="detail-item">
            <label>Department</label>
            <p>{{ selectedUser.department }}</p>
          </div>
          <div class="detail-item">
            <label>Phone</label>
            <p>{{ selectedUser.phone }}</p>
          </div>
          <div class="detail-item">
            <label>Status</label>
            <p>
              <span class="status-badge" [ngClass]="getStatusClass(selectedUser.status)">
                {{ selectedUser.status | titlecase }}
              </span>
            </p>
          </div>
          <div class="detail-item">
            <label>Last Login</label>
            <p>{{ selectedUser.lastLogin }}</p>
          </div>
          <div class="detail-item">
            <label>Created At</label>
            <p>{{ selectedUser.createdAt | date }}</p>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn-secondary" (click)="closeViewModal()">Close</button>
        <button class="btn-primary" (click)="openEditModal(selectedUser); closeViewModal()">Edit</button>
      </div>
    </div>
  </div>

  <!-- Edit User Modal -->
  <div class="modal" *ngIf="showEditModal && selectedUser">
    <div class="modal-content modal-lg">
      <div class="modal-header">
        <h2>Edit User</h2>
        <button class="close-btn" (click)="closeEditModal()">√ó</button>
      </div>
      
      <div class="modal-body">
        <form>
          <div class="form-row">
            <div class="form-group">
              <label>Username *</label>
              <input type="text" [(ngModel)]="selectedUser.username" name="editUsername" required>
            </div>
            <div class="form-group">
              <label>Email *</label>
              <input type="email" [(ngModel)]="selectedUser.email" name="editEmail" required>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Full Name *</label>
              <input type="text" [(ngModel)]="selectedUser.fullName" name="editFullName" required>
            </div>
            <div class="form-group">
              <label>Phone *</label>
              <input type="text" [(ngModel)]="selectedUser.phone" name="editPhone" required>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Role</label>
              <select [(ngModel)]="selectedUser.role" name="editRole">
                <option *ngFor="let role of roles" [value]="role">{{ role | titlecase }}</option>
              </select>
            </div>
            <div class="form-group">
              <label>Department</label>
              <select [(ngModel)]="selectedUser.department" name="editDepartment">
                <option *ngFor="let dept of departments" [value]="dept">{{ dept }}</option>
              </select>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Status</label>
              <select [(ngModel)]="selectedUser.status" name="editStatus">
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
                <option value="suspended">Suspended</option>
              </select>
            </div>
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button class="btn-secondary" (click)="closeEditModal()">Cancel</button>
        <button class="btn-primary" (click)="updateUser()">Update User</button>
      </div>
    </div>
  </div>

  <!-- Permissions Modal -->
  <div class="modal" *ngIf="showPermissionsModal && selectedUser">
    <div class="modal-content modal-lg">
      <div class="modal-header">
        <h2>Manage Permissions - {{ selectedUser.username }}</h2>
        <button class="close-btn" (click)="closePermissionsModal()">√ó</button>
      </div>
      
      <div class="modal-body">
        <p class="permissions-info">Select permissions for this user:</p>
        <div class="permissions-grid">
          <div class="permission-item" *ngFor="let perm of availablePermissions">
            <label>
              <input 
                type="checkbox" 
                [checked]="hasPermission(perm)"
                (change)="togglePermission(perm)"
              >
              {{ getPermissionLabel(perm) }}
            </label>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn-secondary" (click)="closePermissionsModal()">Cancel</button>
        <button class="btn-primary" (click)="updatePermissions()">Save Permissions</button>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal modal-sm" *ngIf="showDeleteModal && selectedUser">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Confirm Delete</h2>
        <button class="close-btn" (click)="closeDeleteModal()">√ó</button>
      </div>
      
      <div class="modal-body">
        <p>Are you sure you want to delete user <strong>"{{ selectedUser.username }}"</strong>?</p>
        <p class="warning-text">This action cannot be undone.</p>
      </div>

      <div class="modal-footer">
        <button class="btn-secondary" (click)="closeDeleteModal()">Cancel</button>
        <button class="btn-danger" (click)="confirmDelete()">Delete</button>
      </div>
    </div>
  </div>
</div>